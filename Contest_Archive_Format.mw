This page describes a draft archivel format for a contest. It is developed in parallell with the REST API (and the JSON Event Feed. It might very well end up being very similar to the CDP which has been suggested to use for this, but which have a slightly different purpose...

== Introduction ==

There are several reasons that contest information will be stored on disk, including:
* As configuration used to initialize a CCS
* As an archive of what happened in a contest
* As an archive for replaying a contest, either for testing contest tools or for teams to compete against live data
* As a base for offline analysis

This standard lays out the relative location and format of each type of contest-related information when reading or writing to disk. The top level structure is based on the [[Contest API]] structure, and a dump of the output from that API is one way to store the data. That said, the archive format allows for any format whose documentation has been registered with the ICPC. The sections below lists all currently known (and thus accepted) formats.

== Structure ==

The Contest Archive consists of a single directory (possibly ZIP compressed) with a metadata file ('''archive.yaml''') and at most a single entry for each of the types of data ('''config''', '''problems''', '''registration''',  '''submissions''', '''judgements''', '''runs''', '''clarifications''', '''awards''', '''scoreboard''', '''events'''). An entry is either a directory with the same name as the type of data, or a file with same base name as the type of data and any file extension.

=== Metadata ===

Archive metadata is stored in a YAML file called '''archive.yaml''' with the following keys:

{| class="wikitable"
! Key !! Description
|-
| created-by || Name of system creating this archive
|-
| archive || ID of format used for content types not listed in archive.yaml
|-
| config || ID of format used for '''config'''
|-
| registration || ID of format used for '''registration'''
|-
| submissions || ID of format used for '''submissions'''
|- 
| judgements || ID of format used for '''judgements'''
|-
| runs || ID of format used for '''runs'''
|-
| clarifications || ID of format used for '''clarifications'''
|-
| awards || ID of format used for '''awards'''
|-
| scoreboard || ID of format used for '''scoreboard'''
|-
| events || ID of format used for '''events'''
|}

Only '''created-by''' is always required, but if any of content type is not listed then '''archive''' must be specified.

==== Example ====

 # Contest Archive
 ---
 created-by: Kattis
 archive:    contest-api
 problems:   kattis
 awards:	    missing

=== Config ===

Configuration data for the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Config_2
|}

=== Problems ===

Problems used at the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| kattis || Kattis problem package format  || http://www.problemarchive.org/ 
|-
| icpc || ICPC problem package format (subset of the Kattis format) || https://clics.ecs.baylor.edu/index.php/Problem_format
|}

=== Registration ===

Registration data for the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Registration_2
|}

=== Submissions ===

Submissions from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Submissions_2
|}

=== Judgements ===

Judgements from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Judgements_2
|}

=== Runs ===

Runs from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Runs_2
|}

=== Clarifications ===

Clarifications from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Clarifications_2
|}

=== Awards ===

A summary of awards handed out at the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Awards_2
|-
| missing || No awards data ||  
|}

=== Scoreboard ===

Final scoreboard from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Scoreboard_2
|}

=== Events ===

List of events from the contest.

The following formats may be used:

{| class="wikitable"
! ID !! Description !! Specification
|-
| contest-api || Contest API dump  || https://clics.ecs.baylor.edu/index.php/Contest_Archive_Format#Events_2
|-
| missing || No awards data ||  
|}

== Contest API archive formats ==

'''NB!''': This section should not be in this document, and is only included here while WIP. It should either be it's own document, or be added to the [[Contest API]] document. Every subsection defines the on disk format '''contest-api''' for a type of data.

=== General principle ===

==== Endpoints with file references ====

Endpoints that have file references (or are likely to have in the future) are stored in a folder per object, using the endpoint name and id as the folder name:
 <endpoint>/<id>/<endpoint>.json
 <endpoint>/<id>/<other files>

<endpoint>.json is a single JSON element containing one object, identical to the API call to /<endpoint>/<id>. Endpoints that follow this format are: organizations, teams, and submissions.

==== Endpoints without additional child endpoints ====

For endpoints that are not likely to have file references there is a simpler format on disk: a single <endpoint>.json file containing the full list of objects. This file is identical to the API call to /<endpoint>. Endpoints that follow this format are: languages, groups, judgement types, clarifications, and awards.

=== Config ===

A directory, '''config''', containing:

* a JSON file (contest.json) for the /contests/<id> endpoint 
* a JSON file (judgement-types.json) for the /contests/<id>/judgement-types endpoint
* a JSON file (languages.json) for the /contests/<id>/languages endpoint
* system.yaml defined in the [[Contest_Control_System_Requirements#system.yaml | CCSR]].
* the contest banner, from the /banner endpoint, if available.
* the contest logo, from the /logo endpoint, if available.

==== File listing ====

 config/contest.json
 config/judgement-types.json
 config/languages.json
 config/system.yaml
 config/banner.png
 config/logo.png

=== Registration ===

A directory, '''registration''', containing:

* a JSON file (groups.json) for the /registration/groups endpoint
* a directory for organizations containing:
** a directory for each organisation using the organisation ID as directory name, containing:
*** a JSON file (organization.json) for the /registration/organizatons/<id> endpoint
*** a file for each endpoint available under /registration/organizatons/<id>
* a directory for teams containing:
** a directory for each team using the team ID as directory name, containing:
*** a JSON file (team.json) for the /registration/teams/<id> endpoint
*** a file for each endpoint available under /registration/teams/<id>
* a directory for team-members containing:
** a directory for each team member using the team member ID as directory name, containing:
*** a JSON file (team-member.json) for the /registration/team-members/<id> endpoint
*** a file for each endpoint available under /registration/team-members/<id>

==== File listing ====

 registration/groups.json
 registration/organizations/<id>/organization.json
 registration/organizations/<organization-id>/logo.png
 registration/organizations/<organization-id>/logo.160px.png
 registration/organizations/<organization-id>/logo.56px.png
 registration/teams/<id>/team.json
 registration/teams/<id>/photo.{png, jpg}
 registration/teams/<id>/backup.zip
 registration/team-members/<id>/team-member.json
 registration/team-members/<id>/photo.{png,jpg}

=== Submissions ===

A directory, '''submissions''', containing:

* a directory for each submission using the submission ID as directory name, containing:
** a JSON file (submission.json) for the /submissions/<id> endpoint
** a file for each endpoint available under /submissions/<id>

==== File listing ====

 submissions/submission.json
 submissions/files.zip
 submissions/reaction.*

=== Judgements ===

A directory, '''judgements''', containing:

* a JSON file (primary.json) for the /judgements endpoint for the primary system
* a JSON file (shadow{1, 2, ...}.json) for the /judgements endpoint for a shadow system if any (use number in case of multiple shadows)

==== File listing ====

 judgements/primary.json
 judgements/shadow.json

=== Runs ===

A directory, '''runs''', containing:

* a JSON file (primary.json) for the /runs endpoint on the primary system
* a JSON file (shadow{1, 2, ...}.json) for the /runs endpoint on a shadow system, if available (use numbering in case of multiple shadows)

==== File listing ====

 runs/primary.json
 runs/shadow.json

=== Clarifications ===

A JSON file, '''clarifications.json''' for the /clarifications endpoint

==== File listsing ====

 clarifications.json

=== Awards ===

A JSON file, '''awards.json''' for the /awards endpoint

==== File listsing ====

 awards.json

=== Scoreboard ===

A JSON file, '''scoreboard.json''' for the /scoreboard endpoint

==== File listsing ====

 scoreboard.json

=== Events ===

A directory, '''events''', containing:

* a JSON file (primary.json) for the /event-feed endpoint on the primary system
* a JSON file (shadow{1, 2, ...}.json) for the /event-feed endpoint on a shadow system, if available (use numbering in case of multiple shadows)
* a JSON file (*.json) for the /event-feed endpoint on any other system producing events, if available (may not be named "primary" or "shadow*")

==== File listing ====

 events/primary.json
 events/shadow.json
 events/cdn.json
