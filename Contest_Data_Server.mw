= Introduction to this DRAFT/working document =

'''This article is DRAFT!!'''   

That means that at any time anything, especially in the details, in
this article could change and likely will.   

At this point this document is being updated by
the SysOps CDS workgroup and is likely to change.

Change include but are not limited to:
# the URLs
# which services will and will not be serviced by the 2014 version of the CDS.
# everything else

The CDS (Services) Specification 1.0 will be formally published and distributed and this article is
not that specification.

== Introduction ==

The Contest Data Server (or CDS) is a single place for clients of any kind to request contest data via URL. This document contains information on what services (URLs) are available from the CDS, what content is returned, and links to specs for the format of some files.

Internally, the CDS may be implemented using multiple servers, pull data from the contest control system or other servers, or even aggregate. From a client perspective the important thing is that ''none of this matters'': the CDS is a one-stop shop for all contest information. Clients only need to know how to connect to URLs.

It's best to think of the CDS as an aggregator and gate keeper. There will be extensions that plug onto the CDS and provide new content or convert formats, but these are more like applications hosted by/within the CDS.

=== Why do we need a CDS? ===

We've run many finals without a CDS, so why do we need one now? Using a CDS has several advantages:

* '''Standard-based''': Regular HTTP access to everything.
* '''Consistency''': Similar URLs and formats where it makes sense.
* '''Simplicity''': A one stop shop for clients. A single URL and access request for multiple services.
* '''Data''': Access to new data like team logos & pictures, contest images, etc.
* '''Security''': HTTPS and single point of control.
* '''Caching''': Reduced load on contest control system.
* '''Robustness''': Clients no longer connect directly to critical contest systems.

There are also some benefits we can take advantage of in the future:
* '''Scale''': Architecture allows us to use an HTTP server and scale out to handle load.
* '''Robustness''': Fail-over with multiple CDS servers. Handle DOS attacks.

=== Implementation Notes ===

* URLs below are in the format "http://cds/xyz". The exact hostname or IP address for 'cds' each year will be provided once the network is setup onsite.
* Some of the URL contain a year (e.g. http://cds/2014/xyz") to indicate that these are temporary formats that will almost definitely change over the following year.
* Invalid URLs, parameters (e.g. teamNum=500), or missing images will return the standard HTTP status code 404.

== Access & Authentication ==

Requests for access to the CDS must be made through the world finals technical director (John Clevenger) and must include contact information for during the finals. Many of the services will contain private information, so each client will be given a unique user id & password to connect to the CDS. Access to all secure services is via HTTPS. (HTTP access will be redirected)

To simplify security, access is provided via roles that each have access to different content. The defined roles are as follows:

* Internal = Internal users (typically on the contest network) that have access to all content.
* Trusted = Clients that have access to some contest information that should not be shared publically.
* Public = All other users that have access only to public information.

Services will be marked with what access role is required.

== Services ==

The following section describes all of the services that are available through the CDS.

=== Configuration ===

==== Contest Configuration ====

 <nowiki>URL: http://cds/config/contest.yaml
URL: http://cds/config/problemset.yaml
URL: http://cds/config/groups.tsv
URL: http://cds/config/teams.tsv</nowiki>

Access to contest configuration files as specified in the CCS spec [[Contest Control System]].

todo: potentially figure out how to pack up all problem files in archive and serve that to a client


=== Images ===

==== Team University Logos ====

 <nowiki>URL: http://cds/images/logo/[teamNum]</nowiki>

Returns a png image 600x600 or smaller of the given team's University logo.

==== Team Photos ====

 <nowiki>URL: http://cds/images/team/[teamNum]</nowiki>

Returns a full HD (1920x1080) jpeg photo of the given team, typically taken during registration.

=== Data Feeds ===

==== Contest Control System Event Feed ====

 <nowiki>URL: http://cds/2014/events</nowiki>

Returns the 2014 event feed as generated by the CCS: [[Event Feed 2014]].

Clients without sufficient access rights will received a filtered event feed not containing submission judgments from the final hour.

==== Contest Control System Event Feed Proposal ====

 <nowiki>URL: http://cds/proposed/events</nowiki>

Returns a modified event feed that will match the proposed future standard. TBD

==== Contest Control System JSON Scoreboard ====

 <nowiki>URL: http://cds/2014/standings</nowiki>

Returns a JSON scoreboard as defined here: [[JSON Scoreboard 2014]]

Clients without sufficient access rights will received a filtered scoreboard that does not contain submission judgments from the final hour.

=== Video Streams ===

==== Team Webcam Stream ====

 <nowiki>URL: http://cds/video/camera/[teamNum]</nowiki>

Returns a video stream from the camera at the given team's workstation.

* Video container: FLV
* Video format: H.264

==== Team Desktop Stream ====

 <nowiki>URL: http://cds/video/screen/[teamNum]</nowiki>

Returns a video stream of the given team's desktop.

* Video container: FLV
* Video format: H.264


=== Other ===

==== ICPC Graphics ====

Returns one of several ICPC graphics images for use by TV Production

==== Submission Source ====

Returns the source files for a team submission given a submission id.

 <nowiki>URL: http://cds/submissionsource/[submissionId]</nowiki>

==== Team backup files ====

Returns an archive (.zip) with files from a Team's machine.

 <nowiki>URL: http://cds/backups/[teamId]</nowiki>
 <nowiki>URL: http://cds/backups/md5/[teamId]</nowiki>
