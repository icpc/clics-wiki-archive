= Introduction to this DRAFT/working document =

'''This article is DRAFT!!'''   

That means that at any time anything, especially in the details, in
this article could change and likely will.   

At this point this document is being updated by
the SysOps CDS workgroup and is likely to change.

Change include but are not limited to:
# the URLs
# which services will and will not be serviced by the 2014 version of the CDS.
# everything else

The CDS (Services) Specification 1.0 will be formally published and distributed and this article is
not that specification.

== Introduction ==

The Contest Data Server (or CDS) is a single place for clients of any kind to request contest data via URL. This document contains information on what services (URLs) are available from the CDS, what content is returned, and links to specs for the format of some files.

Internally, the CDS may be implemented using multiple servers, pull data from the contest control system or other servers, or even aggregate. From a client perspective the important thing is that ''none of this matters'': the CDS is a one-stop shop for all contest information. Clients only need to know how to connect to URLs.

It's best to think of the CDS as an aggregator and gate keeper. There will be extensions that plug onto the CDS and provide new content or convert formats, but these are more like applications hosted by/within the CDS.

=== Why do we need a CDS? ===

We've run many finals without a CDS, so why do we need one now? Using a CDS has several advantages:

* '''Standard-based''': Regular HTTP access to everything.
* '''Consistency''': Similar URLs and formats where it makes sense.
* '''Simplicity''': A one stop shop for clients. A single URL and access request for multiple services.
* '''Data''': Access to new data like team logos & pictures, contest images, etc.
* '''Security''': HTTPS and single point of control.
* '''Caching''': Reduced load on contest control system.
* '''Robustness''': Clients no longer connect directly to critical contest systems.

There are also some benefits we can take advantage of in the future:
* '''Scale''': Architecture allows us to use an HTTP server and scale out to handle load.
* '''Robustness''': Fail-over with multiple CDS servers. Handle DOS attacks.

=== Implementation Notes ===

* URLs below are in the format "http://cds/xyz". The exact hostname or IP address for 'cds' each year will be provided once the network is setup onsite.
* Some of the URL contain a year (e.g. http://cds/2014/xyz") to indicate that these are temporary formats that will almost definitely change over the following year.
* Invalid URLs, parameters (e.g. teamNum=500), or missing images will return the standard HTTP status code 404.

== Access & Authentication ==

Requests for access to the CDS must be made through the world finals technical director (John Clevenger) and must include contact information for during the finals. Many of the services will contain private information, so each client will be given a unique user id & password to connect to the CDS. Access to all secure services is via HTTPS. (HTTP access will be redirected)

To simplify security, access is provided via roles that each have access to different content. The defined roles are as follows:

* Public - Access only to data/services that are public contest info and can be shared externally at any time.
* Analyst - Public + access to team backups and submission source.
* Blue - Full access to all data/services. (e.g. results during final hour)
* Admin - Full access + control authority.

Services will be marked with what access role is required.

[[Contest Security]]
[[Contest Data]]

== Services ==

The following section describes all of the services that are available through the CDS.

=== Configuration ===

==== Contest Configuration ====
 <nowiki>https://cds/config/contest.yaml
https://cds/config/problemset.yaml
https://cds/config/groups.tsv
https://cds/config/teams.tsv</nowiki>
''Access: Public''

Access to contest configuration files as specified in the CCS spec [[Contest Control System]].

todo: potentially figure out how to pack up all problem files in archive and serve that to a client

=== Images ===

==== Team University Logos ====
 <nowiki>https://cds/images/logo/[teamNum]</nowiki>
''Access: Public''

Returns a png image 600x600 or smaller of the given team's University logo.

==== Team Photos ====
 <nowiki>https://cds/images/team/[teamNum]</nowiki>
''Access: Public''

Returns a full HD (1920x1080) jpeg photo of the given team, typically taken during registration.

=== Data Feeds ===

==== Contest Control System Event Feed ====
 <nowiki>https://cds/events</nowiki>
''Access: Public''

Returns the 2014 event feed as generated by the CCS: [[Event Feed 2014]].

Clients without Blue access rights will receive a filtered event feed not containing submission judgments from the final hour.

==== Contest Feed Proposal ====
 <nowiki>https://cds/contest</nowiki>
''Access: Public''

Returns a stream similar to the event feed, but merged with contest data from multiple sources: yamls, tsv, etc. Also supports filters/queries & JSON. Use at your own risk - this feed is being used to test future options.

==== Contest Control System JSON Scoreboard ====
 <nowiki>https://cds/scoreboard</nowiki>
''Access: Public''

Returns a JSON scoreboard as defined here: [[JSON Scoreboard 2014]]

Clients without sufficient access rights will received a filtered scoreboard that does not contain submission judgments from the final hour.

==== Contest RSS Feed (Draft) ====
 <nowiki>https://cds/rss</nowiki>
''Access: Public''

Returns an RSS feed of solved submissions, e.g. "University of X solved problem Y!"

Clients without sufficient access rights will received a filtered RSS feed that does not contain submission judgments from the final hour.

=== Video ===

==== Team Webcam Stream ====
 <nowiki>http://cds/video/camera/[teamNum]</nowiki>
''Access: Public''

Returns a video stream from the camera at the given team's workstation.

* Video container: MPEG-TS
* Video codec: H.264

==== Team Desktop Stream ====
 <nowiki>http://cds/video/screen/[teamNum]</nowiki>
''Access: Public''

Returns a video stream of the given team's desktop.

* Video container: MPEG-TS
* Video codec: H.264

==== Channels ====

Channels are a paired camera & screen video that can be changed on demand. It allows a client to use a fixed url for the duration of the contest, and for another user (typically an analyst) to switch which team the client is watching.

 <nowiki>http://cds/video/camera/channel/[channelNum]</nowiki>
 <nowiki>http://cds/video/screen/channel/[channelNum]</nowiki>
''Access: Public''

Returns video streams of the given channel, with content and format identical to the team webcam and desktop streams above.

 <nowiki>http://cds/video/channel/[channelNum]/[teamNum]</nowiki>
''Access: Public''

Changes the given channel to output from the given team.

==== Reaction Videos ====
 <nowiki>http://cds/video/reaction/[submissionId]</nowiki>
''Access: Public''

Returns a camera recording of the team for the given submission. Each video is X seconds long.
Returns a 404 if the submission id is invalid or the video was not finished recording.

* Video container: MPEG-TS
* Video codec: H.264

=== Other ===

==== ICPC Graphics ====

Returns one of several ICPC graphics images for use by TV Production

==== Team Overlay Images ====
 <nowiki>https://cds/images/teamOverlay/[teamNum]</nowiki>
''Access: Public''

Returns a full HD (1920x1080) png containing the team logo and name, for use as an overlay graphic.

==== Submission Source ====
 <nowiki>https://cds/submissionFiles/[submissionId]</nowiki>
''Access: Analyst''

Returns the source files for a team submission given a submission id.

==== Team backup files ====
 <nowiki>https://cds/backups/[teamId]</nowiki>
''Access: Analyst''

Returns an archive (.tar.gz) with backup files from a Team's machine.
