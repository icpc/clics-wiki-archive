== Introduction ==

This page describes a '''draft''' API for accessing information provided by a [[Contest_Control_System]] or [[CDS|Contest Data Server]].
Such an API can be used by a multitude of clients:
* an external scoreboard
* a scoreboard resolver application
* contest analysis software, such as the [[ICAT]] toolset
* another "shadow" CCS, providing a run-forwarding interface to it
* internally, to interface between the CCS server and judging instances

This API is meant to be useful, not only at the ICPC World Finals, but more generally in any ICPC-style contest setup.

== General design principles ==

The interface is implemented as a HTTP REST interface that outputs information in [https://en.wikipedia.org/wiki/JSON JSON] format. The specific base URL will be dependent on the server (main CCS or CDS) providing the service and will be indicated as <tt>baseurl</tt>.

Query parameters are passed as variables in the URL instead of encoded in the URL path, e.g.
  GET http://example.com/team?id=10
instead of
  GET http://example.com/team/10

Rationale: this allows for more flexibility to later extend/generalize the interface, e.g. to return results depending on a filter:
  http://example.com/team?group=europe

Access to (parts of) the API is optionally controlled by HTTP authentication. This provides a standard and flexible method, while the user one authenticates as can be used for fine-grained access control to specific bits.

=== Recurring details ===

'''Timestamps''' (type <tt>&lt;TIME&gt;</tt> in the specification)
are encoded as floats without exponent representing Unix
Epoch seconds. The API and client must accept floats with up to 9
digits after the decimal point and should provide microsecond
resolution, for example: <tt>1390517449.324</tt>, truncating (i.e.
rounding down) internal timestamps when necessary, so in a 5 hour
contest a submission at 18000 seconds is late.
The rationale for Epoch is that it is independent of time zone, easily
parsable and supported in about any possible language.

'''Identifiers''' (type <tt>&lt;ID&gt;</tt> in the specification)
Should these be integer or string type? If string, do we want to restrict these to certain characters or limit the length?
For 2016 use integers.

'''File contents''' (type <tt>&lt;BASE64&gt;></tt> in the specification)
are base64 encoded. This allows it to be embedded as strings in the JSON with other data.
For smallish files (such as source code) the additional encoding overhead in size and time is not an issue;
for large files, one should probably revert to providing these separately in a raw format.
'''TODO''': in this case replace the contents with a download URL?

== Interface specification ==

The following list of API calls are to be supported; <tt>baseurl</tt> denotes an HTTP or HTTPS URL at which this API is provided.

=== GET baseurl/contest ===

Provides information on the current contest.

Parameters: ''none''

Returns a JSON object with the elements below. If there is no current (this may include about to start or just finished) contest, returns an empty object <tt>{}</tt>.
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the current contest
|-
| name
| string
| yes
| name of the contest
|-
| start
| TIME
| yes
| start time of the contest
|-
| length
| integer
| yes
| contest length in seconds
|-
| penalty
| integer
| yes for WF
| penalty time per wrong submission, in seconds
|-
| freeze
| integer
| yes for WF
| time after contest start that scoreboard is frozen, in seconds
|}

=== GET baseurl/problems ===

Lists problems in the current contest.

Parameters: ''none''

Returns a JSON array, with each element an object describing a problem, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| ?
| identifier of the problem
|-
| label
| string
| yes
| label of the problem in the contest, typically a single capitalized letter
|-
| short_name
| string
| yes
| brief name of the problem (restrict to, say, 10 characters?)
|-
| name
| string
| yes
| name of the problem
|-
| rgb
| string
| no
| hexadecimal RGB value of problem color as specified in [http://en.wikipedia.org/wiki/Web_colors#Hex_triplet HTML hexadecimal colors], e.g. '#AC00FF' or '#fff'
|-
| color
| string
| no
| human readable color description associated to the RGB value
<!-- Save this for later discussion - Jaap, 2015-02-11
|-
| timelimit
| float
| no
| time limit per testcase in seconds
|-
| memorylimit
| integer
| no
| memory limit in KiB
|-
| text
| BASE64
| no
| Problem description text ('''TODO''': in which format? PDF/HTML, either, add mime-type, unspecified?)
-->
|}

==== Example ====

Request:
  GET http://example.com/problems
Returned data:
  [{id:"10","label":"A","shortname":"asteroids","name":"Asteroid Rangers","rgb":"#00f","color":"blue"},
   {id:"84","label":"B","shortname":"bottles","name":"Curvy Little Bottles","rgb":"#808080","color":"gray"},
   ...
  ]

=== GET baseurl/languages ===

Lists programming languages that can be used for submissions.

Parameters: ''none''

Returns a JSON array, with each element an object describing a language, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the language
|-
| name
| string
| yes
| name of the language
|}

=== GET baseurl/teams ===

Lists all teams.
'''TODO''': also show inactive/special teams depending on authentication level of client (with extra tag)?

Parameters: ''none''

Returns a JSON array, with each element an object describing a team, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the team
|-
| name
| string
| yes
| name of the team
|-
| affiliation
| string
| yes for WF
| name of university or other entity that team is affiliated to (may be same as name at WFs)
|-
| nationality
| string
| yes for WF
| [https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3 ISO 3-letter code] of the team's nationality
|-
| group
| string
| yes for WF
| group this team is part of (in ICPC WFs these are the super-regions, such as Europe)
<!-- Save this for later discussion - Jaap, 2015-02-11
|-
| external-id
| string
| yes for WF?
| external identifier for this team, e.g. from imported ICPC data
-->
|}

==== Example ====

Request:
  GET http://example.com/teams
Returned data:
  [{"id":42,"name":"Shanghai Jiao Tong University","nationality":"CHN","affiliation":"Shanghai Jiao Tong University","group":"Asia",},
   {"id":11,"name":"CMU1","nationality":"USA","affiliation":"Carnegie Mellon University","group":"North America"},
   ...
  ]

=== GET baseurl/submissions ===

List of submissions in the current contest.

Parameters:
* '''firstid''' (optional) identifier of first in range of submissions to list
* '''lastid''' (optional) identifier of last in range of submissions to list

Returns a JSON array, with each element an object describing a submission, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the submission
|-
| team
| ID
| yes
| identifier of the team that made the submission
|-
| problem
| ID
| yes
| identifier of the problem submitted for
|-
| language
| ID
| yes
| identifier of the language submitted for
|-
| time
| TIME
| yes
| timestamp of when the submission was made
|}

=== GET baseurl/submission_files ===

This provides the file(s) of a specific submission, see also the [[Draft_2014_REST_interface_for_source_code_fetching]].

Parameters:
* '''id''' (required) identifier of the submission

Returns a JSON array, with each element an object describing a file, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Description
|-
| filename
| string
| filename of this file (without path? any disallowed characters?)
|-
| content
| BASE64
| base64 encoded contents of the file
|}

'''To be added''': how to encode encode for Java submissions which file contains the main class, and/or what the main class name is?

==== Example ====

Request:
  GET http://example.com/submission_files?id=223
Returned data:
  [{"filename":"a.java","content":"&lt;base64_string&gt;"},{"filename":"helper.java","content":"&lt;base64_string&gt;"}]

=== GET baseurl/judgings ===

Lists judgings of submissions.
'''TODO''': does this format of providing judging information separately from submissions fit all CCS's?
Rationale for this choice is that a rejudging does/need not affect previously published submission or judging information.

Parameters:
* '''firstid''' (optional) identifier of first in range of judgings to list
* '''lastid''' (optional) identifier of last in range of judgings to list

Returns a JSON array, with each element an object describing a judging, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the judging
|-
| submission
| ID
| yes
| identifier of the submission judged
|-
| outcome
| string
| yes
| result of judging, '''NULL''' if judging has not finished yet.
|}

=== GET baseurl/testcases ===

Lists testcases for a problem.

Parameters:
* '''problem''' identifier of a problem

Returns a JSON array, with each element an object describing a testcase, with the following elements:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| id
| ID
| yes
| identifier of the testcase
|-
| description
| string
| no
| description of the testcase, e.g. which corner case it tests
|-
| sample
| boolean
| no
| whether this is a sample testcase (i.e. publicly available)
|-
| input
| BASE64
| ?
| input for this testcase (base64 encoded, or provided as a separate raw URL?)
|-
| answer
| BASE64
| ?
| jury (reference) answer for this testcase (base64 encoded, or provided as a separate raw URL?)
|}

=== GET baseurl/scoreboard ===

Provides the scoreboard of the current contest.

Parameters: ''none''

Returns a JSON array where each element is an object that represents a row for one team. The array is
sorted according to rank and alphabetical on team name within identically ranked teams.
Each row object contains:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| rank
| integer
| yes
| rank of this team, 1-based and duplicate in case of ties
|-
| team
| ID
| yes
| identifier of the team as in <tt>teams</tt> API call.
|-
| score
| object
| yes
| object (for possible extension to other scoring methods) containing integer elements "num_solved" and "total_time"
|-
| problems
| array
| yes
| array of problems with scoring data, see below for the specification of each element
|}
Each problem element within the scoreboard consists of:
{| class="wikitable"
|-
! Name
! Type
! Required?
! Description
|-
| label
| string
| yes
| label of the problem as in <tt>problems</tt> API call.
|-
| num_judged
| integer
| yes
| number of judged submissions (including possibly a final correct one)
|-
| num_pending
| integer
| yes
| number of pending submissions (either queued or due to freeze)
|-
| solved
| boolean
| yes
| whether the team solved this problem
|-
| time
| integer
| yes
| present if solved, minutes into the contest when solved by team
|}

==== Example ====

Request:
  GET http://example.com/scoreboard
Returned data:
  [{"rank":1,"team":42,"score":{"num_solved":3,"total_time":340},
    "problems":[
     {"label":"A","num_judged":3,"num_pending":1,"solved":false},
     {"label":"B","num_judged":1,"num_pending":0,"solved":true,"time":20},
     {"label":"C","num_judged":2,"num_pending":0,"solved":true,"time":55},
     {"label":"D","num_judged":0,"num_pending":0,"solved":false},
     {"label":"E","num_judged":3,"num_pending":0,"solved":true,"time":205}
    ]},
   ...
  ]
